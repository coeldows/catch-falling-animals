<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catch the Falling Animals</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; background: #e0f7fa; }
    #homeScreen, #gameScreen {
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    #gameCanvas { display: none; background: #e0f7fa; }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #ff4081;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    #restartBtn, #pauseBtn, #musicBtn {
      position: absolute;
      top: 10px;
    }
    #restartBtn { right: 10px; display: none; }
    #pauseBtn { left: 10px; }
    #musicBtn { left: 100px; }
    #hud {
      position: absolute;
      top: 50px;
      left: 10px;
      color: black;
      font-size: 20px;
    }
  </style>
</head>
<body>

<div id="homeScreen">
  <h1>Catch the Falling Animals</h1>
  <button id="playBtn">Play Game</button>
</div>

<div id="gameScreen" style="display: none; position: relative;">
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <div id="hud"></div>
  <button id="pauseBtn">Pause</button>
  <button id="musicBtn">Music Off</button>
  <button id="restartBtn">Restart</button>
</div>

<audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2023/07/25/audio_3f589eaf3f.mp3?filename=happy-calm-music-146095.mp3" loop></audio>

<script>
const playBtn = document.getElementById('playBtn');
const homeScreen = document.getElementById('homeScreen');
const gameScreen = document.getElementById('gameScreen');
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const restartBtn = document.getElementById('restartBtn');
const pauseBtn = document.getElementById('pauseBtn');
const musicBtn = document.getElementById('musicBtn');
const bgMusic = document.getElementById('bgMusic');
const hud = document.getElementById('hud');

let basket, objects, animals, score, lives, gameOver, flashTimer, keys, level, slowDownTimer, doublePointsTimer, highScore, paused, basketJumpTimer, catchStreak;
let spawnInterval;
let animationFrameId;

const backgroundImage = new Image();
backgroundImage.src = 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?crop=entropy&cs=tinysrgb&fit=crop&h=600&w=400';

backgroundImage.onload = () => {
  playBtn.addEventListener('click', () => {
    homeScreen.style.display = 'none';
    gameScreen.style.display = 'block';
    canvas.style.display = 'block';
    bgMusic.play();
    initGame();
    if (spawnInterval) clearInterval(spawnInterval);
    spawnInterval = setInterval(spawnObject, 1000);
    if (animationFrameId) cancelAnimationFrame(animationFrameId);
    gameLoop();
  });
};

function initGame() {
  basket = { x: 160, y: 550, width: 80, height: 20, speed: 5 };
  objects = [];
  animals = ['üê±', 'üê∂', 'üêò', 'üêñ'];
  score = 0;
  lives = 5;
  gameOver = false;
  flashTimer = 0;
  keys = {};
  level = 1;
  slowDownTimer = 0;
  doublePointsTimer = 0;
  highScore = localStorage.getItem('highScore') || 0;
  paused = false;
  basketJumpTimer = 0;
  catchStreak = 0;
}

document.addEventListener('keydown', (e) => keys[e.key] = true);
document.addEventListener('keyup', (e) => keys[e.key] = false);

restartBtn.addEventListener('click', () => {
  restartBtn.style.display = 'none';
  initGame();
  if (spawnInterval) clearInterval(spawnInterval);
  spawnInterval = setInterval(spawnObject, 1000);
  if (animationFrameId) cancelAnimationFrame(animationFrameId);
  gameLoop();
});

pauseBtn.addEventListener('click', () => {
  paused = !paused;
  pauseBtn.textContent = paused ? 'Resume' : 'Pause';
});

musicBtn.addEventListener('click', () => {
  if (bgMusic.paused) {
    bgMusic.play();
    musicBtn.textContent = 'Music Off';
  } else {
    bgMusic.pause();
    musicBtn.textContent = 'Music On';
  }
});

function spawnObject() {
  let type = animals[Math.floor(Math.random() * animals.length)];
  objects.push({
    x: Math.random() * (canvas.width - 40),
    y: -40,
    size: 30,
    speedX: (Math.random() - 0.5) * (level >= 2 ? 6 : 4),
    speedY: 2 + Math.random() * (level >= 3 ? 8 : 3),
    type: type
  });
}

function update() {
  if (gameOver || paused) return;

  if (keys['ArrowLeft'] && basket.x > 0) basket.x -= basket.speed;
  if (keys['ArrowRight'] && basket.x < canvas.width - basket.width) basket.x += basket.speed;
  if (keys['ArrowUp'] && basket.y > 0) basket.y -= basket.speed;
  if (keys['ArrowDown'] && basket.y < canvas.height - basket.height) basket.y += basket.speed;

  for (let i = 0; i < objects.length; i++) {
    objects[i].y += objects[i].speedY;

    if (level >= 2) {
      objects[i].x += objects[i].speedX;
      if (objects[i].x <= 0 || objects[i].x + objects[i].size >= canvas.width) {
        objects[i].speedX *= -1;
      }
    }

    if (objects[i].y + objects[i].size > basket.y &&
        objects[i].x + objects[i].size > basket.x &&
        objects[i].x < basket.x + basket.width) {
      score++;
      basketJumpTimer = 10;
      catchStreak++;
      objects.splice(i, 1);
      if (catchStreak >= 5 && lives < 5) {
        lives++;
        catchStreak = 0;
      }
    }
  }

  lives -= objects.filter(obj => obj.y > canvas.height).length;
  objects = objects.filter(obj => obj.y <= canvas.height);

  if (lives <= 0) {
    if (score > highScore) {
      localStorage.setItem('highScore', score);
      highScore = score;
    }
    gameOver = true;
    flashTimer = 0;
    restartBtn.style.display = 'block';
  }
}

function draw() {
  if (backgroundImage.complete) {
    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
  } else {
    ctx.fillStyle = '#e0f7fa';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  ctx.fillStyle = 'blue';
  let jumpOffset = basketJumpTimer > 0 ? -10 : 0;
  ctx.fillRect(basket.x, basket.y + jumpOffset, basket.width, basket.height);

  ctx.font = '24px Arial';
  for (let obj of objects) {
    ctx.fillText(obj.type, obj.x, obj.y);
  }

  hud.innerHTML = `Score: ${score}<br>High Score: ${highScore}<br>Lives: ${'‚ù§Ô∏è'.repeat(lives)}`;

  if (gameOver) {
    flashTimer++;
    ctx.font = '40px Impact';
    ctx.fillStyle = flashTimer % 20 < 10 ? 'white' : 'red';
    ctx.textAlign = 'center';
    ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2);
  }
}

function gameLoop() {
  update();
  draw();
  if (!gameOver) {
    animationFrameId = requestAnimationFrame(gameLoop);
  }
}
</script>
</body>
</html>