
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Catch the Falling Animals</title>
<!-- CSS omitted for brevity -->
</head>
<body>
<!-- HTML structure omitted for brevity -->
<script>
const playBtn = document.getElementById('playBtn');
const homeScreen = document.getElementById('homeScreen');
const gameScreen = document.getElementById('gameScreen');
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const restartBtn = document.getElementById('restartBtn');
const pauseBtn = document.getElementById('pauseBtn');
const musicBtn = document.getElementById('musicBtn');
const bgMusic = document.getElementById('bgMusic');
const hud = document.getElementById('hud');

let basket, objects, animals, score, lives, gameOver, flashTimer, keys, level, slowDownTimer, doublePointsTimer, highScore, paused, basketJumpTimer, catchStreak;
let spawnInterval;
let animationFrameId; // New fix added

const backgroundImage = new Image();
backgroundImage.src = 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?crop=entropy&cs=tinysrgb&fit=crop&h=600&w=400';

playBtn.addEventListener('click', () => {
  homeScreen.style.display = 'none';
  gameScreen.style.display = 'block';
  canvas.style.display = 'block';
  bgMusic.play();
  initGame();
  if (spawnInterval) clearInterval(spawnInterval);
  spawnInterval = setInterval(spawnObject, 1000);
  if (animationFrameId) cancelAnimationFrame(animationFrameId);
  gameLoop();
});

function initGame() {
  basket = { x: 160, y: 550, width: 80, height: 20, speed: 5 };
  objects = [];
  animals = ['üê±', 'üê∂', 'üêò', 'üêñ'];
  score = 0;
  lives = 5;
  gameOver = false;
  flashTimer = 0;
  keys = {};
  level = 1;
  slowDownTimer = 0;
  doublePointsTimer = 0;
  highScore = localStorage.getItem('highScore') || 0;
  paused = false;
  basketJumpTimer = 0;
  catchStreak = 0;
}

// Other functions remain the same but gameLoop now:
function gameLoop() {
  update();
  draw();
  if (!gameOver) {
    animationFrameId = requestAnimationFrame(gameLoop);
  }
}
</script>
</body>
</html>
